<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Faz Bradford Drifting</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #000;
    touch-action: none;
    font-family: Arial, sans-serif;
  }

  .controls {
    position: fixed;
    bottom: 20px;
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
    pointer-events: none;
  }

  .group {
    display: flex;
    gap: 15px;
    pointer-events: auto;
  }

  .btn {
    width: 65px;
    height: 65px;
    border-radius: 50%;
    background: rgba(255,255,255,0.25);
    color: white;
    font-size: 26px;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
  }

  .btn:active {
    background: rgba(255,255,255,0.45);
  }
</style>
</head>
<body>

<!-- TOUCH CONTROLS -->
<div class="controls">
  <div class="group">
    <div class="btn" id="left">⬅️</div>
    <div class="btn" id="right">➡️</div>
  </div>
  <div class="group">
    <div class="btn" id="brake">⬇️</div>
    <div class="btn" id="gas">⬆️</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158/build/three.min.js"></script>
<script>
/* =======================
   SCENE & RENDERER
======================= */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x9ecae1);
scene.fog = new THREE.Fog(0x9ecae1, 40, 220);

const camera = new THREE.PerspectiveCamera(
  70,
  window.innerWidth / window.innerHeight,
  0.1,
  500
);

const renderer = new THREE.WebGLRenderer({ antialias: false });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
document.body.appendChild(renderer.domElement);

/* =======================
   LIGHTING
======================= */
scene.add(new THREE.AmbientLight(0xffffff, 0.6));
const sun = new THREE.DirectionalLight(0xffffff, 0.8);
sun.position.set(50, 100, 30);
scene.add(sun);

/* =======================
   GROUND
======================= */
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(500, 500),
  new THREE.MeshStandardMaterial({ color: 0x3a3a3a })
);
ground.rotation.x = -Math.PI / 2;
scene.add(ground);

/* =======================
   ROADS
======================= */
function road(x, z, w, h) {
  const r = new THREE.Mesh(
    new THREE.PlaneGeometry(w, h),
    new THREE.MeshStandardMaterial({ color: 0x222222 })
  );
  r.rotation.x = -Math.PI / 2;
  r.position.set(x, 0.01, z);
  scene.add(r);
}

for (let i = -200; i <= 200; i += 40) {
  road(i, 0, 12, 500);
  road(0, i, 500, 12);
}

/* =======================
   BUILDINGS
======================= */
function building(x, z) {
  const h = 6 + Math.random() * 24;
  const b = new THREE.Mesh(
    new THREE.BoxGeometry(12, h, 12),
    new THREE.MeshStandardMaterial({ color: 0x8fa3b8 })
  );
  b.position.set(x, h / 2, z);
  scene.add(b);
}

for (let x = -180; x <= 180; x += 20) {
  for (let z = -180; z <= 180; z += 20) {
    if (Math.abs(x) < 10 || Math.abs(z) < 10) continue;
    if (Math.random() > 0.65) building(x, z);
  }
}

/* =======================
   PLAYER CAR
======================= */
const car = new THREE.Mesh(
  new THREE.BoxGeometry(2, 1, 4),
  new THREE.MeshStandardMaterial({ color: 0xff3333 })
);
car.position.y = 0.5;
scene.add(car);

let speed = 0;
let direction = 0;

/* =======================
   TOUCH INPUT
======================= */
const input = { gas:false, brake:false, left:false, right:false };

function bind(id, key) {
  const el = document.getElementById(id);
  el.addEventListener("touchstart", e => { e.preventDefault(); input[key] = true; });
  el.addEventListener("touchend",   e => { e.preventDefault(); input[key] = false; });
}

bind("gas","gas");
bind("brake","brake");
bind("left","left");
bind("right","right");

/* =======================
   AI TRAFFIC
======================= */
const traffic = [];
const TRAFFIC_COUNT = 14;

function spawnTraffic() {
  const tcar = new THREE.Mesh(
    new THREE.BoxGeometry(2, 1, 4),
    new THREE.MeshStandardMaterial({ color: 0xdddddd })
  );

  const vertical = Math.random() > 0.5;
  if (vertical) {
    tcar.position.set(Math.random() > 0.5 ? 40 : -40, 0.5, Math.random() * 400 - 200);
    tcar.rotation.y = Math.PI;
  } else {
    tcar.position.set(Math.random() * 400 - 200, 0.5, Math.random() > 0.5 ? 40 : -40);
    tcar.rotation.y = -Math.PI / 2;
  }

  scene.add(tcar);

  traffic.push({
    mesh: tcar,
    axis: vertical ? "z" : "x",
    dir: Math.random() > 0.5 ? 1 : -1,
    speed: 0.4 + Math.random() * 0.6
  });
}

for (let i = 0; i < TRAFFIC_COUNT; i++) spawnTraffic();

/* =======================
   GAME LOOP
======================= */
function animate() {
  requestAnimationFrame(animate);

  // Player movement
  if (input.gas) speed += 0.015;
  if (input.brake) speed -= 0.02;
  speed *= 0.95;

  if (input.left) direction += 0.04;
  if (input.right) direction -= 0.04;

  car.rotation.y = direction;
  car.position.x -= Math.sin(direction) * speed;
  car.position.z -= Math.cos(direction) * speed;

  // Camera
  camera.position.lerp(
    new THREE.Vector3(
      car.position.x,
      car.position.y + 6,
      car.position.z + 12
    ),
    0.12
  );
  camera.lookAt(car.position);

  // AI traffic movement
  traffic.forEach(t => {
    t.mesh.position[t.axis] += t.speed * t.dir;
    if (t.mesh.position.distanceTo(car.position) > 240) {
      t.mesh.position[t.axis] = -t.dir * 220;
    }
  });

  renderer.render(scene, camera);
}

animate();

/* =======================
   RESIZE
======================= */
window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
