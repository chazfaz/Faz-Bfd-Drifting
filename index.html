<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Faz Bradford Drifting</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #000;
    touch-action: none;
    font-family: Arial, sans-serif;
  }

  /* HUD */
  #hud {
    position: fixed;
    top: 10px;
    left: 10px;
    color: white;
    font-size: 16px;
    z-index: 10;
  }

  #speed {
    font-size: 20px;
    margin-bottom: 6px;
  }

  #minimap {
    position: fixed;
    top: 10px;
    right: 10px;
    width: 120px;
    height: 120px;
    background: rgba(0,0,0,0.6);
    border-radius: 10px;
    overflow: hidden;
  }

  #minimap canvas {
    width: 100%;
    height: 100%;
  }

  /* Controls */
  .controls {
    position: fixed;
    bottom: 20px;
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
    pointer-events: none;
  }

  .group {
    display: flex;
    gap: 15px;
    pointer-events: auto;
  }

  .btn {
    width: 65px;
    height: 65px;
    border-radius: 50%;
    background: rgba(255,255,255,0.25);
    color: white;
    font-size: 22px;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
  }

  .btn:active {
    background: rgba(255,255,255,0.45);
  }
</style>
</head>
<body>

<!-- HUD -->
<div id="hud">
  <div id="speed">0 km/h</div>
</div>

<div id="minimap">
  <canvas id="map" width="120" height="120"></canvas>
</div>

<!-- CONTROLS -->
<div class="controls">
  <div class="group">
    <div class="btn" id="left">‚¨ÖÔ∏è</div>
    <div class="btn" id="right">‚û°Ô∏è</div>
  </div>
  <div class="group">
    <div class="btn" id="handbrake">üÖó</div>
    <div class="btn" id="brake">‚¨áÔ∏è</div>
    <div class="btn" id="gas">‚¨ÜÔ∏è</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158/build/three.min.js"></script>
<script>
/* ================= SCENE ================= */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x9ecae1);
scene.fog = new THREE.Fog(0x9ecae1, 40, 240);

const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 500);

const renderer = new THREE.WebGLRenderer({ antialias:false });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio,1.5));
document.body.appendChild(renderer.domElement);

/* ================= LIGHT ================= */
scene.add(new THREE.AmbientLight(0xffffff,0.6));
const sun = new THREE.DirectionalLight(0xffffff,0.8);
sun.position.set(50,100,20);
scene.add(sun);

/* ================= CITY ================= */
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(500,500),
  new THREE.MeshStandardMaterial({color:0x3a3a3a})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

function road(x,z,w,h){
  const r = new THREE.Mesh(
    new THREE.PlaneGeometry(w,h),
    new THREE.MeshStandardMaterial({color:0x222222})
  );
  r.rotation.x = -Math.PI/2;
  r.position.set(x,0.01,z);
  scene.add(r);
}

for(let i=-200;i<=200;i+=40){
  road(i,0,12,500);
  road(0,i,500,12);
}

function building(x,z){
  const h = 6 + Math.random()*24;
  const b = new THREE.Mesh(
    new THREE.BoxGeometry(12,h,12),
    new THREE.MeshStandardMaterial({color:0x8fa3b8})
  );
  b.position.set(x,h/2,z);
  scene.add(b);
}

for(let x=-180;x<=180;x+=20){
  for(let z=-180;z<=180;z+=20){
    if(Math.abs(x)<10||Math.abs(z)<10) continue;
    if(Math.random()>0.65) building(x,z);
  }
}

/* ================= PLAYER ================= */
const car = new THREE.Mesh(
  new THREE.BoxGeometry(2,1,4),
  new THREE.MeshStandardMaterial({color:0xff3333})
);
car.position.y = 0.5;
scene.add(car);

let speed = 0;
let direction = 0;
let driftAngle = 0;

/* ================= INPUT ================= */
const input = {gas:false, brake:false, left:false, right:false, handbrake:false};

function bind(id,key){
  const el = document.getElementById(id);
  el.addEventListener("touchstart",e=>{e.preventDefault();input[key]=true;});
  el.addEventListener("touchend",e=>{e.preventDefault();input[key]=false;});
}

bind("gas","gas");
bind("brake","brake");
bind("left","left");
bind("right","right");
bind("handbrake","handbrake");

/* ================= CAMERA FOLLOW ================= */
const camOffset = new THREE.Vector3(0,6,12);

/* ================= MINIMAP ================= */
const map = document.getElementById("map");
const mctx = map.getContext("2d");

/* ================= LOOP ================= */
function animate(){
  requestAnimationFrame(animate);

  /* Acceleration */
  if(input.gas) speed += 0.02;
  if(input.brake) speed -= 0.03;
  speed *= input.handbrake ? 0.92 : 0.97;

  /* Steering */
  let turnStrength = input.handbrake ? 0.06 : 0.04;
  if(input.left) direction += turnStrength;
  if(input.right) direction -= turnStrength;

  /* Drift */
  driftAngle += (direction - driftAngle) * (input.handbrake ? 0.15 : 0.05);

  car.rotation.y = driftAngle;
  car.position.x -= Math.sin(direction) * speed;
  car.position.z -= Math.cos(direction) * speed;

  /* Camera follow turn */
  const camTarget = car.position.clone()
    .add(camOffset.clone().applyAxisAngle(new THREE.Vector3(0,1,0), driftAngle));
  camera.position.lerp(camTarget,0.1);
  camera.lookAt(car.position);

  /* Speed HUD */
  document.getElementById("speed").innerText =
    Math.abs(Math.round(speed*120))+" km/h";

  /* Minimap */
  mctx.clearRect(0,0,120,120);
  mctx.fillStyle="#444";
  mctx.fillRect(0,0,120,120);
  mctx.fillStyle="red";
  mctx.fillRect(
    60 + car.position.x*0.1,
    60 + car.position.z*0.1,
    4,4
  );

  renderer.render(scene,camera);
}
animate();

/* ================= RESIZE ================= */
addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>