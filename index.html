<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Faz Drifting BFD</title>
<script src="https://cdn.jsdelivr.net/npm/three@0.167.1/build/three.min.js"></script>
<style>
body { margin:0; overflow:hidden; font-family: Arial,sans-serif; background:#000; }
canvas { display:block; }

/* Start screen overlay */
#startScreen {
  position: absolute;
  top:0; left:0;
  width:100%; height:100%;
  background: url('/mnt/data/A_digital_illustration_in_GTA_V-style_features_a_s.png') center center / cover no-repeat;
  z-index: 10;
  display: flex;
  justify-content: center;
  align-items: flex-end;
  flex-direction: column;
  color: white;
  font-size: 32px;
  text-shadow: 0 0 15px black;
  cursor: pointer;
  padding-bottom: 80px;
  text-align: center;
}

/* HUD */
#hud {
  position: absolute; top: 20px; left: 20px; color: white; 
  background: rgba(0,0,0,0.7); padding: 20px; border-radius: 15px; z-index: 10; 
  font-size: 18px; box-shadow: 0 0 20px rgba(255,68,68,0.5);
}

/* Instructions */
#instructions {
  position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); 
  background: rgba(0,0,0,0.8); padding: 20px; border-radius: 15px; color: #fff; 
  text-align: center; z-index: 10; max-width: 90%; font-size: 16px;
}
</style>
</head>
<body>

<!-- Start Screen -->
<div id="startScreen">
  TAP TO START<br>or PRESS SPACE
</div>

<!-- HUD -->
<div id="hud">
  Speed: <span id="speed">0</span> km/h | 
  Drift Points: <span id="points">0</span> | 
  Money: $<span id="money">0</span>
</div>

<!-- Instructions -->
<div id="instructions">
  WASD = Accelerate/Brake/Steer | SPACE = Handbrake Drift<br>
  Explore the city, complete missions, avoid police!
</div>

<script>
let isGameStarted = false;
let driftPoints = 0;
let money = 0;

// =====================
// Start Game Function
// =====================
function startGame() {
  if (isGameStarted) return;
  isGameStarted = true;
  document.getElementById('startScreen').style.display = 'none';
  animate();
}

// Event listeners
window.addEventListener('click', startGame);
window.addEventListener('touchstart', startGame);
window.addEventListener('keydown', e => { if(e.code==='Space') startGame(); });

// =====================
// Three.js Setup
// =====================
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);
scene.fog = new THREE.FogExp2(0x87ceeb, 0.00025);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 5000);
camera.position.set(0,10,20);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

// Lights
const ambient = new THREE.AmbientLight(0x404040, 0.6);
scene.add(ambient);

const dirLight = new THREE.DirectionalLight(0xffffff,1.2);
dirLight.position.set(200,300,100);
dirLight.castShadow = true;
scene.add(dirLight);

// =====================
// Ground
// =====================
const groundGeo = new THREE.PlaneGeometry(4000,4000);
const groundMat = new THREE.MeshLambertMaterial({color:0x222222});
const ground = new THREE.Mesh(groundGeo,groundMat);
ground.rotation.x = -Math.PI/2;
ground.receiveShadow = true;
scene.add(ground);

// Road Grid
const gridSize = 200;
const lineMatWhite = new THREE.MeshLambertMaterial({color:0xffffff});
const lineMatYellow = new THREE.MeshLambertMaterial({color:0xffff00});
for(let i=-2000;i<=2000;i+=gridSize){
  const hLine=new THREE.Mesh(new THREE.BoxGeometry(4000,0.3,8),lineMatWhite);
  hLine.position.set(0,0.15,i);
  scene.add(hLine);
  const vLine=new THREE.Mesh(new THREE.BoxGeometry(4000,0.3,8),lineMatYellow);
  vLine.rotation.y=Math.PI/2;
  vLine.position.set(i,0.15,0);
  scene.add(vLine);
}

// =====================
// Player Car
// =====================
const carGroup=new THREE.Group();
const bodyGeo=new THREE.BoxGeometry(2.2,1.1,4.4);
const bodyMat=new THREE.MeshLambertMaterial({color:0xff3333});
const body=new THREE.Mesh(bodyGeo,bodyMat);
body.castShadow=true;
carGroup.add(body);

// Windshields
const winMat=new THREE.MeshLambertMaterial({color:0x223366,transparent:true,opacity:0.6});
const frontWin=new THREE.Mesh(new THREE.BoxGeometry(1.9,0.9,0.2),winMat);
frontWin.position.set(0,0.45,1.9);
carGroup.add(frontWin);
const rearWin=new THREE.Mesh(new THREE.BoxGeometry(1.7,0.7,0.2),winMat);
rearWin.position.set(0,0.35,-1.7);
carGroup.add(rearWin);

// Wheels
const wheelGeo=new THREE.CylinderGeometry(0.45,0.45,0.35,12);
const wheelMat=new THREE.MeshLambertMaterial({color:0x111111});
const playerWheels=[];
for(let i=0;i<4;i++){
  const wheel=new THREE.Mesh(wheelGeo,wheelMat);
  wheel.rotation.z=Math.PI/2;
  wheel.castShadow=true;
  playerWheels.push(wheel);
  carGroup.add(wheel);
}
playerWheels[0].position.set(-1.2,-0.55,1.6);
playerWheels[1].position.set(1.2,-0.55,1.6);
playerWheels[2].position.set(-1.2,-0.55,-1.6);
playerWheels[3].position.set(1.2,-0.55,-1.6);

scene.add(carGroup);
carGroup.position.set(0,0.5,0);

// =====================
// Player Input
// =====================
const velocity=new THREE.Vector3();
let moveForward=false, moveBackward=false, moveLeft=false, moveRight=false, handbrake=false;

document.addEventListener('keydown',(e)=>{
  switch(e.code){
    case 'KeyW': moveForward=true; break;
    case 'KeyS': moveBackward=true; break;
    case 'KeyA': moveLeft=true; break;
    case 'KeyD': moveRight=true; break;
    case 'Space': handbrake=true; break;
  }
});

document.addEventListener('keyup',(e)=>{
  switch(e.code){
    case 'KeyW': moveForward=false; break;
    case 'KeyS': moveBackward=false; break;
    case 'KeyA': moveLeft=false; break;
    case 'KeyD': moveRight=false; break;
    case 'Space': handbrake=false; break;
  }
});

// =====================
// Animate Loop
// =====================
function animate(){
  requestAnimationFrame(animate);
  if(!isGameStarted) return;

  // Player movement
  let accel=0;
  if(moveForward) accel+=1;
  if(moveBackward) accel-=0.6;
  velocity.z+=accel*0.12;
  const drag=handbrake?0.82:0.96;
  velocity.z*=drag;
  const maxSpeed=2.2;
  velocity.z=Math.max(-maxSpeed*0.7,Math.min(velocity.z,maxSpeed));

  let steer=0;
  if(moveLeft) steer-=1;
  if(moveRight) steer+=1;
  const steerSpeed=0.06*(Math.min(1,Math.abs(velocity.z)/1.5)+0.3);
  carGroup.rotation.y+=steer*steerSpeed;

  // Move car
  carGroup.position.x+=Math.sin(carGroup.rotation.y)*velocity.z;
  carGroup.position.z+=Math.cos(carGroup.rotation.y)*velocity.z;

  // Rotate wheels
  const wheelSpeed=velocity.z*4;
  playerWheels.forEach(wheel=>{wheel.rotation.x+=wheelSpeed;});

  // HUD update
  document.getElementById('speed').textContent=Math.floor(Math.abs(velocity.z)*45);
  document.getElementById('points').textContent=Math.floor(driftPoints);
  document.getElementById('money').textContent=Math.floor(money);

  // Camera
  const camOffset=new THREE.Vector3(0,10+Math.abs(velocity.z)*0.8,20+Math.abs(velocity.z)*1.2);
  camOffset.applyQuaternion(carGroup.quaternion);
  camOffset.add(carGroup.position);
  camera.position.lerp(camOffset,0.12);
  camera.lookAt(carGroup.position.clone().add(new THREE.Vector3(0,2,5).applyQuaternion(carGroup.quaternion)));

  renderer.render(scene,camera);
}

// Resize
window.addEventListener('resize',()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>
</body>
</html>
