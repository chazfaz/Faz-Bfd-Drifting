<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Faz Drifting BFD - 3D Open World with Traffic</title>
    <script src="https://cdn.jsdelivr.net/npm/three@0.167.1/build/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: Arial, sans-serif; }
        #hud { 
            position: absolute; top: 20px; left: 20px; color: white; 
            background: rgba(0,0,0,0.7); padding: 20px; border-radius: 15px; z-index: 10; 
            font-size: 18px; box-shadow: 0 0 20px rgba(255,68,68,0.5);
        }
        #startScreen {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; color: white; font-size: 32px; z-index: 20;
        }
        #girlImage {
            position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%);
            z-index: 20;
            width: 150px;
        }
        #instructions { 
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); 
            background: rgba(0,0,0,0.8); padding: 20px; border-radius: 15px; color: #fff; 
            text-align: center; z-index: 10; max-width: 90%; font-size: 16px;
        }
        canvas { display: block; }
    </style>
</head>
<body>

    <!-- Start Screen -->
    <div id="startScreen">
        <div id="gameTitle">FAZ DRIFTING BFD</div>
        <div>Tap or press Space to start</div>
    </div>

    <!-- Girl Image (for the start screen) -->
    <img id="girlImage" src="https://example.com/girl-bikini.png" alt="Girl in Bikini" width="150">

    <div id="hud">
        Speed: <span id="speed">0</span> km/h | 
        Drift Points: <span id="points">0</span> | 
        Money: $<span id="money">0</span> | 
        Wanted Level: <span id="wanted">0</span>
    </div>
    <div id="instructions">
        WASD = Accelerate/Brake/Steer | SPACE = Handbrake Drift<br>
        Explore the city, complete missions, avoid police!
    </div>

    <script>
        // =======================
        // Variables for the Game
        // =======================
        let isGameStarted = false;
        let money = 0;
        let driftPoints = 0;
        let wantedLevel = 0;
        let carSpeed = 2.2;
        let upgradeLevel = 0; // Tracks car upgrades

        // =======================
        // Scene & Renderer Setup
        // =======================
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb);
        scene.fog = new THREE.FogExp2(0x87ceeb, 0.00025);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 5000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 0.8;
        document.body.appendChild(renderer.domElement);

        // Lighting
        const ambient = new THREE.AmbientLight(0x404040, 0.6);
        scene.add(ambient);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.2);
        dirLight.position.set(200, 300, 100);
        dirLight.castShadow = true;
        dirLight.shadow.mapSize.width = 4096;
        dirLight.shadow.mapSize.height = 4096;
        scene.add(dirLight);

        // Ground (asphalt)
        const groundGeo = new THREE.PlaneGeometry(4000, 4000);
        const groundMat = new THREE.MeshLambertMaterial({ color: 0x222222 });
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        // =======================
        // Player Car Setup
        // =======================
        const carGroup = new THREE.Group();
        const bodyGeo = new THREE.BoxGeometry(2.2, 1.1, 4.4);
        const bodyMat = new THREE.MeshLambertMaterial({ color: 0xff3333 });
        const body = new THREE.Mesh(bodyGeo, bodyMat);
        body.castShadow = true;
        carGroup.add(body);

        // Windshield
        const winMat = new THREE.MeshLambertMaterial({ color: 0x223366, transparent: true, opacity: 0.6 });
        const frontWin = new THREE.Mesh(new THREE.BoxGeometry(1.9, 0.9, 0.2), winMat);
        frontWin.position.set(0, 0.45, 1.9);
        carGroup.add(frontWin);
        const rearWin = new THREE.Mesh(new THREE.BoxGeometry(1.7, 0.7, 0.2), winMat);
        rearWin.position.set(0, 0.35, -1.7);
        carGroup.add(rearWin);

        // Wheels
        const wheelGeo = new THREE.CylinderGeometry(0.45, 0.45, 0.35, 12);
        const wheelMat = new THREE.MeshLambertMaterial({ color: 0x111111 });
        const playerWheels = [];
        for (let i = 0; i < 4; i++) {
            const wheel = new THREE.Mesh(wheelGeo, wheelMat);
            wheel.rotation.z = Math.PI / 2;
            wheel.castShadow = true;
            playerWheels.push(wheel);
            carGroup.add(wheel);
        }
        playerWheels[0].position.set(-1.2, -0.55, 1.6);  // FL
        playerWheels[1].position.set(1.2, -0.55, 1.6);   // FR
        playerWheels[2].position.set(-1.2, -0.55, -1.6); // RL
        playerWheels[3].position.set(1.2, -0.55, -1.6);  // RR

        scene.add(carGroup);
        carGroup.position.set(0, 0.5, 0);

        // =======================
        // Start Screen Logic
        // =======================
        function startGame() {
            isGameStarted = true;
            document.getElementById('startScreen').style.display = 'none'; // Hide start screen
            animate(); // Start the game loop
        }

        // Handle touch and space key press
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && !isGameStarted) {
                startGame();
            }
        });

        window.addEventListener('click', () => {
            if (!isGameStarted) {
                startGame();
            }
        });

        // =======================
        // Player Control & Physics
        // =======================
        const velocity = new THREE.Vector
